require 5.002 ;
use ExtUtils::MakeMaker 5.16 ;
use Config ;

use strict ;
use vars qw($ZLIB_LIB $ZLIB_INCLUDE $zlib_version $ZLIB_VERSION) ;

# If libz is not installed in some place obvious, uncomment the next
# line and change the path to point to the directory where libz is
# installed.

#$ZLIB_LIB     = '-L/usr/local/lib' ;
$ZLIB_LIB     = '-L./zlib-1.0.2' ;

# Change the path on the next line to point to the directory where
# zlib.h and zconf.h can be found.

#$ZLIB_INCLUDE = '-I./zlib-1.0.2' ;
$ZLIB_INCLUDE = '-I./zlib-1.0.2' ;


# It shouldn't be necessary to change anything from here on.

#CheckZlibVersion(0.99) ;

WriteMakefile(	
                NAME   	 	=> 'Compress::Zlib',
		VERSION_FROM  	=> 'Zlib.pm',
		LIBS	 	=> [ "$ZLIB_LIB -lz " ],
	      	INC      	=> " $ZLIB_INCLUDE" ,
		'dist'	 	=> {COMPRESS=>'gzip', SUFFIX=>'gz'},
	    ) ;



sub CheckZlibVersion
{
    my $version = shift ;
    my $file = "tmp.xxx" ;

    open (F, "$file") ;
    print F <<EOM ;
#include <stdio.h>
#include <zlib.h>
     
main()
{
    printf("zlib_version = %s\n", zlib_version) ;
    printf("ZLIB_VERSION = %s\n", ZLIB_VERSION) ;
}
EOM
    close F ;
     
    $x = `$Config{'cc'} $file 2>&1`;
 
 
    unlink('a.out') if (-f 'a.out');
    unlink $file ;

    warn "zlib.a and zlib.h are not the same version\n"
	unless $zlib_version eq $ZLIB_VERSION ;

    die "Installed zlib is version $zlib_version. \n"
	unless $zlib_version >= $version ;
}

sub try_compile
{
 my $file  = shift;
 my $msgs  = `$Config{'cc'} $file 2>&1`;
 my $ok = ($? == 0);
 unlink('a.out') if (-f 'a.out');
 return $ok;
}
 
sub try_run
{
 my $file  = shift;
 my $msgs  = `$Config{'cc'} $file 2>&1`;
 my $ok = ($? == 0);
 if ($ok)
  {
   system('a.out');
   $ok = ($? == 0);
  }
 unlink('a.out') if (-f 'a.out');
 return $ok;
}
 
 
# Check for the version of zlib
$file = "tmp.xxx" ;
open (F, "$file") ;
print F <<EOM ;
#include <zlib.h>
 
main()
{
    printf("zlib_version = %s\n", zlib_version) ;
    printf("ZLIB_VERSION = %s\n", ZLIB_VERSION) ;
}
EOM
close F ;
 
$x = `$Config{'cc'} $file 2>&1`;
 
 
unlink('a.out') if (-f 'a.out');

