
use Dist ;


# If zlib.h isn't stored someplace obvious
# for example:
#
#    $DBH_L = "-I/usr/local/include" ;
#
$DBH_I = "-I." ;

# If libz isn't stored 
# for example:
#
#    $DBH_L = "-L/usr/local/bin" ;
#
#$DBH_L = "" ;

#########################
#
#  Don't change anything from here on.
#
#########################

$header = "zlib.h" ;
$library = "z" ;
$module  = "Compress::Zlib" ;
($module_path = $module) =~ s#::#/#g ;

$dist = new Dist ;

# Check if DB_File is already installed
foreach (@INC) {
    next if(/site_perl/);
    push (@conflict, $_) if -e "$_/$module_path.pm" ;
}

	warn <<"MSG_EOF" if @conflict ;
*** WARNING ***
An installed copy of the $module module found in the following directories
   @conflict
This can cause a version conflict as this version installs in
    $dist->{installprivlib}/site_perl
which comes later in Perl $]'s include directory list.

You may need to manually remove these older $module directories if
this version of $module does not run correctly.

MSG_EOF



if ($DBH_I) {
    $dist->{'ccflags'} = "$DBH_I $dist->{'ccflags'}" ;
    print "Checking...\n" ;
    #if (-r $DBH_I)
}


# see if this is a db.h system
print "\nChecking for $header...\n" ;
my $x = $dist->findhdr ($header) ;

if ($x) 
  { print "Found it at $x\n" }
else {
    print "Could not find it.\n" ;
    exit 1 ;
}

# check for libdb
print "\nChecking for library lib$library...\n" ;
@a = $dist->chkLib("-l$library") ;
print "@a\n" ;
if ($a[3])
  { print "found it in $a[3]\n" }
else {
    print "could not find it. \n" ;
    exit 1 ;
}


    $dist->{'ldflags'} = "$dist->{'ldflags'} $a[2]" ;
print "\nChecking the version of libz...\n" ;
($status, $msg) = $dist->compile_and_run(<<'EOM') ;
#include <stdio.h>
#include <zlib.h>
 
main()
{
    printf("zlib_version = %s\n", zlib_version) ;
    printf("ZLIB_VERSION = %s\n", ZLIB_VERSION) ;
    exit (0) ;
}
EOM

die "oops!\n" if $status ;

$msg =~ /zlib_version = (.*)\n/ ;
$l_version = $1 ;
print "libz is version $l_version " ;

$msg =~ /ZLIB_VERSION = (.*)\n/ ;
$i_version = $1 ;
print "and zlib.h is version $i_version\n" ;

if ($i_version eq $l_version) 
  { print "Good [$l_version][$i_version]\n" }
